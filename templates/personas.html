<!doctype html><meta name=viewport content="width=device-width,initial-scale=1">
<title>Persona Editor</title>
<style>
 body{background:#0f0f0f;color:#e6fff6;font-family:system-ui;margin:12px}
 .row{display:flex;gap:8px;align-items:center;flex-wrap:wrap}
 select,button,input,textarea{font-size:16px;padding:10px;border-radius:10px;border:1px solid #2b3a3a;background:#12181f;color:#dff}
 textarea{width:100%;height:60vh}
 .ok{color:#8affc1} .err{color:#ff9b9b}
</style>

<div class=row>
  <select id=persona></select>
  <button onlick="changePersona()">Switch to this model</button>
</div>

<script>
const s = id => document.getElementById(id);

async function init() {
  const r = await fetch("/personas"); const list = await r.json();
  s("persona").innerHTML = list.map(n=>`<option>${n}</option>`).join("");
  if (list.length) { s("persona").value = list[0]; loadPersona(); }
}

async function changePersona(){
  const name = s("persona").value;
  s("status").textContent = "Loading…";
  const r = await fetch(`/switch-assistants/${encodeURIComponent(name)}`);
  const data = await r.json();
  s("editor").value = JSON.stringify(data, null, 2);
  s("status").textContent = "Loaded";
  s("status").className = "ok";
}


async function loadPersona() {
  const name = s("persona").value;
  s("status").textContent = "Loading…";
  const r = await fetch(`/personas/${encodeURIComponent(name)}`);
  const data = await r.json();
  s("editor").value = JSON.stringify(data, null, 2);
  s("status").textContent = "Loaded";
  s("status").className = "ok";
}

function pretty() {
  try {
    const obj = JSON.parse(s("editor").value);
    s("editor").value = JSON.stringify(obj, null, 2);
    s("status").textContent = "Prettified";
    s("status").className = "ok";
  } catch (e) {
    s("status").textContent = "JSON error: " + e.message;
    s("status").className = "err";
  }
}

async function save() {
  const name = s("persona").value;
  try {
    const obj = JSON.parse(s("editor").value);
    const r = await fetch(`/personas/${encodeURIComponent(name)}`, {
      method: "PUT", headers: {"Content-Type":"application/json"},
      body: JSON.stringify(obj)
    });
    if (!r.ok) throw new Error(await r.text());
    s("status").textContent = "Saved";
    s("status").className = "ok";
  } catch (e) {
    s("status").textContent = "Save failed: " + e.message;
    s("status").className = "err";
  }
}

init();
</script>